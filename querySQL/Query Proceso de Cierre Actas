WITH main_table AS (
    SELECT
        id AS acta_id,
        stg_properties_inspectionform.property_id,
        TO_CHAR(stg_properties_inspectionform.created_at,'YYYY-MM-DD') as created_at,
        general_observation,
        cleaning_observation,
        is_habitable,
        requires_cleaning,
        energy_status,
        gas_status,
        water_status,
        ROW_NUMBER() OVER (PARTITION BY stg_properties_inspectionform.property_id ORDER BY stg_properties_inspectionform.created_at DESC) AS row_number
    FROM dbt_staging.stg_properties_inspectionform
    LEFT JOIN dbt_processing.proc_core_properties
        ON proc_core_properties.property_id = stg_properties_inspectionform.property_id
    WHERE TRUE 
        AND country = 'Chile'
        AND stg_properties_inspectionform.created_at >= '2025-06-01'
)

SELECT * 
FROM main_table
WHERE row_number = 1
ORDER BY created_at DESC


-- SELECT * FROM dbt_processing.proc_scheduler_schedules WHERE schedule_id = 1027146
